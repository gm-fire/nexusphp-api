(()=>{var t={n:o=>{var n=o&&o.__esModule?()=>o.default:()=>o;return t.d(n,{a:n}),n},d:(o,n)=>{for(var e in n)t.o(n,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:n[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),t.d(o,{extend:()=>Y});const n=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/app"];var s=t.n(e);const r=flarum.core.compat["forum/components/PostUser"];var a=t.n(r);const i=flarum.core.compat["common/components/Button"];var u=t.n(i);const c=flarum.core.compat["forum/components/CommentPost"];var p=t.n(c);function l(t,o){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},l(t,o)}function f(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,l(t,o)}const d=flarum.core.compat["common/components/Modal"];var h=t.n(d);const b=flarum.core.compat["common/utils/Stream"];var g=t.n(b);const y=flarum.core.compat["common/utils/extractText"];var v=t.n(y),x=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.seedbonus=g()(100),this.success=!1;var n=this.attrs.user,e=this.attrs.post;this.nickname=g()(n.data.attributes.displayName),this.username=g()(n.data.attributes.username),this.postId=g()(e.data.id)},n.className=function(){return"SeedBonusModal Modal--medium"},n.title=function(){return s().translator.trans("gm-fire-nexusphp-api.forum.seedbonus.title")},n.content=function(){return this.success?m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},s().translator.trans("gm-fire-nexusphp-api.forum.seedbonus.confirmation_message")),m("div",{className:"Form-group"},m(u(),{className:"Button Button--primary Button--block",onclick:this.hide.bind(this)},s().translator.trans("gm-fire-nexusphp-api.forum.seedbonus.dismiss_button"))))):m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m("input",{type:"number",min:"100",autocomplete:"off",name:"senndbonus",className:"FormControl",max:"10000000",onblur:this.seedbonus(this.seedbonus().toString().replace(/[^0-9-]/g,"")),bidi:this.seedbonus,placeholder:s().translator.trans("gm-fire-nexusphp-api.forum.seedbonus.title_placeholder"),disabled:this.loading})),m("div",{className:"Form-group"},m(u(),{className:"Button Button--primary Button--block",type:"submit",loading:this.loading,disabled:this.loading},s().translator.trans("gm-fire-nexusphp-api.forum.seedbonus.submit_button")))))},n.onsubmit=function(t){var o=this;t.preventDefault(),"number"==typeof parseInt(this.seedbonus())&&(this.loading=!0,s().request({method:"POST",url:s().forum.attribute("apiUrl")+"/seedbonus",body:{data:{nickname:this.nickname,username:this.username,seedbonus:this.seedbonus,postId:this.postId}}}).then((function(t){0===t.data.attributes.ret?o.success=!0:s().alerts.show({type:"error"},v()(t.data.attributes.msg)),o.loading=!1,m.redraw()})).catch((function(t){throw o.loading=!1,m.redraw(),t})))},o}(h());const _=flarum.core.compat["common/components/Link"];var P=t.n(_);const N=flarum.core.compat["common/helpers/punctuateSeries"];var B=t.n(N);const k=flarum.core.compat["common/helpers/username"];var O=t.n(k);const w=flarum.core.compat["common/helpers/icon"];var j=t.n(w);const S=flarum.core.compat["forum/components/UserPage"];var M=t.n(S);const U=flarum.core.compat["common/components/LinkButton"];var T=t.n(U);const C=flarum.core.compat["common/Component"];var F=t.n(C);const I=flarum.core.compat["common/components/Tooltip"];var R=t.n(I),L=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var n=o.prototype;return n.oninit=function(o){var n=this;t.prototype.oninit.call(this,o);var e=this.attrs.user;this.medals=[],e.data.attributes&&s().request({method:"GET",url:s().forum.attribute("apiUrl")+"/medals",params:{username:e.data.attributes.username}}).then((function(t){n.medals=JSON.parse(t.data.id),m.redraw()}))},n.view=function(){var t=this.medals||[],o=s().data.nexusphpApiPluginSettings.apiurl+"/userdetails.php?id="+this.attrs.user.data.attributes.username;return m("[",null,m("div",{class:"PostUser-medals"},m("span",{class:"PostUser-text"},t.length?t.map((function(t){var o="<img src="+t.image_large+' data-reaction height="185px" width="185px;"/>';return m(R(),{text:o,html:!0},m("img",{src:t.image_small,title:t.name,"data-reaction":!0,class:"image"}))})):"")),m("div",{class:"PostUser-details"},m("a",{href:o,target:"_blank"},"详细资料")))},o}(F());const q=flarum.core.compat["forum/components/NotificationGrid"];var A=t.n(q);const G=flarum.core.compat["forum/components/Notification"];var z=t.n(G);const D=flarum.core.compat["common/utils/string"];var E=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var n=o.prototype;return n.icon=function(){return"fas fa-yen-sign"},n.href=function(){return s().route.post(this.attrs.notification.subject())},n.content=function(){var t=this.attrs.notification.fromUser();return s().translator.trans("gm-fire-nexusphp-api.forum.notifications.post_bonus_text",{user:t,count:1})},n.excerpt=function(){return(0,D.truncate)(this.attrs.notification.subject().contentPlain(),200)},o}(z()),H=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var n=o.prototype;return n.icon=function(){return"fas fa-pencil-alt"},n.href=function(){return s().route.post(this.attrs.notification.subject())},n.content=function(){var t=this.attrs.notification.fromUser();return s().translator.trans("gm-fire-nexusphp-api.forum.notifications.post_reply_text",{user:t,count:1})},n.excerpt=function(){return(0,D.truncate)(this.attrs.notification.subject().contentPlain(),200)},o}(z());const J=flarum.core.compat["common/extenders"];var K=t.n(J);const Q=flarum.core.compat["common/models/Post"];var V=t.n(Q);const W=flarum.core.compat["forum/components/PostsUserPage"];var X=function(t){function o(){return t.apply(this,arguments)||this}return f(o,t),o.prototype.loadResults=function(t){return s().store.find("posts",{filter:{type:"comment",likedBy:this.user.id()},page:{offset:t,limit:this.loadLimit},sort:"-createdAt"})},o}(t.n(W)());const Y=[(new(K().Routes)).add("user.bonus","/u/:username/bonus",X),new(K().Model)(V()).hasMany("bonus").attribute("bonusCount")],Z={"nexusphp-api/components/BonusUserPage":X,"nexusphp-api/components/PostBonusNotification":E},$=flarum.core;s().initializers.add("gm-fire-nexusphp-api",(function(){s().notificationComponents.postBonus=E,s().notificationComponents.postReply=H,(0,n.extend)(p().prototype,"actionItems",(function(t){var o=this.attrs.post,n=o.user(),e=s().session.user&&n!==s().session.user;!o.isHidden()&&s().forum.attribute("gm-fire-nexusphp-api.seedbonusOpen")&&e&&t.add("seedbonus",m(u(),{className:"Button Button--link",onclick:function(){return s().modal.show(x,{user:n,post:o})}},s().forum.attribute("gm-fire-nexusphp-api.seedbonusLabel")))})),(0,n.extend)(p().prototype,"footerItems",(function(t){var o=this.attrs.post,n=o.bonus();if(n&&n.length){var e=o.bonusCount()>4,r=n.sort((function(t){return t===s().session.user?-1:1})).slice(0,e?3:4).map((function(t){return m(P(),{href:s().route.user(t)},t===s().session.user?s().translator.trans("gm-fire-nexusphp-api.forum.post.you_text"):O()(t))}));if(e){var a=o.bonusCount()-r.length,i=s().translator.trans("gm-fire-nexusphp-api.forum.post.others_link",{count:a});r.push(m("span",null,i))}t.add("bonus",m("div",{className:"Post-bonusBy"},j()("fas fa-yen-sign"),s().translator.trans("gm-fire-nexusphp-api.forum.post.bonus_by_text",{count:r.length,users:B()(r)})))}})),(0,n.extend)(M().prototype,"navItems",(function(t){var o=this.user;t.add("bonus",m(T(),{href:s().route("user.bonus",{username:null==o?void 0:o.slug()}),icon:"fas fa-yen-sign"},s().translator.trans("gm-fire-nexusphp-api.forum.user.bonus_link")),88)})),(0,n.extend)(a().prototype,"view",(function(t){var o=this.attrs.post.user();o&&t.children.push(L.component({user:o}))})),(0,n.extend)(A().prototype,"notificationMethods",(function(t){t.add("push",{name:"push",icon:"fas fa-people-arrows",label:s().translator.trans("gm-fire-nexusphp-api.forum.settings.push_header")})})),(0,n.extend)(A().prototype,"notificationTypes",(function(t){t.add("postReply",{name:"postReply",icon:"fas fa-pencil-alt",label:s().translator.trans("gm-fire-nexusphp-api.forum.settings.notify_post_reply_label")})})),(0,n.extend)(A().prototype,"notificationTypes",(function(t){t.add("postBonus",{name:"postBonus",icon:"fas fa-yen-sign",label:s().translator.trans("gm-fire-nexusphp-api.forum.settings.notify_post_bonus_label")})}))})),Object.assign($.compat,Z)})(),module.exports=o})();
//# sourceMappingURL=forum.js.map